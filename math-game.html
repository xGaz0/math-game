<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>80 in 8 Math Game (Full Version)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
 body { background: #f8fafc; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
 #container { max-width: 520px; width: 98%; }
 #question { min-height: 80px; padding: 18px 12px; border: 1px solid #dee2e6; border-radius: 0.375rem; background-color: #f9fafb;
             text-align: center; display: flex; align-items: center; justify-content: center;
             font-size: 1.7rem; font-weight: 500; }
 .option-btn { flex: 1 1 45%; min-width: 115px; max-width: 48%; font-size: 1.15rem; font-weight: 500; text-align: center; }
 #options { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 1.1rem; }
 #timer { font-size: 2rem; text-align: center; font-weight: 700; color: #2d7dcd; letter-spacing: 1.5px; margin-bottom: 1.2rem; }
 .reveal-correct { background: #22c55e !important; color: #fff !important; border-color: #22c55e !important; }
 .reveal-wrong { background: #ef4444 !important; color: #fff !important; border-color: #ef4444 !important; }
 #analysis tbody tr.correct { background-color: #d1e7dd; }
 #analysis tbody tr.incorrect { background-color: #f8d7da; }
 .ans-ok { color: #16a34a; font-weight: 700; }
 .ans-bad { color: #dc2626; font-weight: 700; }
 .badge-score { font-size: 1.08em; padding: 0.7em 1.7em; display: inline-block; font-weight: 600; margin-bottom: 1.2rem; }
</style>
</head>
<body>
<div id="container" class="card shadow-lg p-4">
  <h2 class="text-center mb-3">80 in 8 Math Game <span class="badge bg-primary">MCQ</span></h2>
  <button id="start" class="btn btn-success btn-lg w-100 mb-3">Start Game</button>
  <div id="score" class="fw-semibold mb-2 d-none"></div>
  <div id="timer" class="mb-3 d-none"></div>
  <div id="question" class="mb-3 d-none"></div>
  <div id="options" class="mb-3 d-none"></div>
  <div id="feedback" class="fw-bold mb-2 d-none"></div>
  <div id="end" class="alert alert-success d-none text-center"></div>
  <div id="analysisWrap" class="d-none">
    <div class="fw-semibold text-center mb-2">Question-by-Question Review</div>
    <div id="scorecardRow" class="text-center mb-2"></div>
    <div class="table-responsive">
      <table id="analysis" class="table table-bordered table-striped table-sm"></table>
    </div>
  </div>
  <button id="restart" class="btn btn-outline-primary w-100 d-none">Restart</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const numQuestions = 80;
const timeLimit = 8 * 60;
let questions = [], userHistory = [];
let current = 0, correct = 0, incorrect = 0;
let startTime, timerInterval;

function shuffle(arr) { for (let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
function rand(min, max) { return Math.floor(Math.random() *(max - min + 1)) + min; }

function generateQuestionWithOptions() {
  const ops = ["+", "-", "×", "÷", "sciMult"];
  const op = ops[Math.floor(Math.random() * ops.length)];
  let a,b,ans,answerText,options=[];

  if (op==="+") { a=rand(1,99); b=rand(1,99); ans=a+b; }
  else if (op==="-") { b=rand(1,99); a=rand(b,99); ans=a-b; }
  else if (op==="×") { a=rand(2,20); b=rand(2,20); ans=a*b; }
  else if (op==="÷") { b=rand(2,20); ans=rand(2,20); a=b*ans; }
  else if (op==="sciMult") {
    let small1=rand(1,9), small2=rand(1,9), exp1=rand(-3,3), exp2=rand(-3,3);
    a = `${small1} × 10^${exp1}`;
    b = `${small2} × 10^${exp2}`;
    let valueA = small1 * Math.pow(10, exp1), valueB = small2 * Math.pow(10, exp2);
    let numericAns = valueA * valueB;
    if (Math.abs(numericAns) < 1) numericAns = parseFloat(numericAns.toFixed(6));
    answerText = numericAns;
    options = [answerText];
    while (options.length < 4) {
      let opt = options[options.length-1] / 10;
      if (!options.includes(opt)) options.push(opt);
      else { let fallback = opt / 10; if (!options.includes(fallback)) options.push(fallback); }
    }
    shuffle(options);
    return {a,b,op,ans:answerText,options};
  }

  answerText = ans; options=[answerText];
  if (Math.random()<0.5) {
    let lastDigit = answerText % 10, candidate2, tries=0;
    do {
      let base = answerText + rand(-15,15);
      candidate2 = base - (base % 10) + lastDigit;
      if (candidate2 <= 0) candidate2 += 10; tries++;
    } while ((candidate2===answerText || options.includes(candidate2)) && tries<20);
    if (!options.includes(candidate2)) options.push(candidate2);
  }
  while (options.length<4) {
    let opt;
    if (op==="÷") { opt = answerText + rand(-10,10); if (opt <= 0) opt += rand(1,10); }
    else { let deltas = [-15,-10,-5,-3,-2,-1,1,2,3,5,10,15]; opt = answerText + deltas[rand(0,deltas.length-1)]; }
    if (!options.includes(opt) && opt!==answerText && opt>-100 && opt<1000) options.push(opt);
  }
  shuffle(options);
  return {a,b,op,ans:answerText,options};
}

function setupQuestions(){ questions=[]; for(let i=0;i<numQuestions;i++){questions.push(generateQuestionWithOptions());} shuffle(questions); }

function showTimer(){ let timePassed=Math.floor((Date.now()-startTime)/1000);
  let remain=Math.max(0,timeLimit-timePassed);
  let min=Math.floor(remain/60), sec=remain%60;
  document.getElementById("timer").textContent = `⏰ ${min}:${sec.toString().padStart(2,"0")}`;
  if(remain===0) endGame();
}

function displayQuestion(){
  if(current>=numQuestions){ endGame(); return; }
  const q = questions[current];
  document.getElementById("score").textContent=`Question ${current+1} of ${numQuestions} | Correct: ${correct} | Incorrect: ${incorrect}`;

  let questionText="";
  if(q.op==="sciMult"){
    if(typeof q.a === "string" && q.a.includes("× 10^")){
      let [mA,eA] = q.a.split("× 10^"), [mB,eB] = q.b.split("× 10^");
      let numA = Math.round( parseFloat(mA) * Math.pow(10, parseInt(eA)) * 10000000) / 10000000;
      let numB =  Math.round( parseFloat(mB) * Math.pow(10, parseInt(eB)) * 10000000) / 10000000;
      questionText = `${numA} × ${numB} = ?`;
    } else { questionText = `${q.a} × ${q.b} = ?`; }
  }
  else if(q.op==="÷"){
    questionText = `<div style="display:inline-block; text-align:center; line-height:1.2;">
      <div>${q.a}</div>
      <div style="border-top:2px solid #000; margin:0 auto; width:60px;">${q.b}</div>
    </div>`;
  }
  else { questionText = `${q.a} ${q.op} ${q.b} = ?`; }

  document.getElementById("question").innerHTML=questionText;
  const optionsDiv=document.getElementById("options"); optionsDiv.innerHTML="";
  q.options.forEach((opt,idx)=>{
    let btn=document.createElement("button");
    btn.className='option-btn btn btn-outline-secondary';
    btn.innerText=opt;
    btn.onclick=()=>selectAnswer(opt, idx);
    optionsDiv.appendChild(btn);
  });
}

function selectAnswer(selected, idxClicked){
  const q = questions[current];
  let expected = q.ans;
  let isCorrect = selected === expected;
  let optionButtons = Array.from(document.querySelectorAll(".option-btn"));
  optionButtons.forEach(btn=>btn.disabled=true);
  let idxCorrect = q.options.findIndex(v=>v===expected);
  optionButtons[idxCorrect].classList.add("reveal-correct");
  if(idxClicked!==idxCorrect) optionButtons[idxClicked].classList.add("reveal-wrong");
  userHistory.push({question: formatQuestionText(q), userAnswer:selected, correctAnswer:expected, isCorrect});
  if(isCorrect) correct++; else incorrect++;
  setTimeout(()=>{ current++; displayQuestion(); }, 200);
}

function formatQuestionText(q){
  if(q.op==="sciMult" && typeof q.a==="string" && q.a.includes("× 10^")){
    let [mA,eA] = q.a.split("× 10^"), [mB,eB] = q.b.split("× 10^");
    let numA = parseFloat(mA) * Math.pow(10, parseInt(eA));
    let numB = parseFloat(mB) * Math.pow(10, parseInt(eB));
    return `${numA} × ${numB}`;
  }
  if(q.op==="÷"){ return `${q.a} ÷ ${q.b}`; }
  return `${q.a} ${q.op} ${q.b}`;
}

function startGame(){
  document.getElementById("start").classList.add("d-none");
  setupQuestions(); userHistory=[]; current=0; correct=0; incorrect=0;
  startTime=Date.now(); showTimer(); timerInterval=setInterval(showTimer,1000);
  ["score","timer","question","options"].forEach(id=>document.getElementById(id).classList.remove("d-none"));
  document.getElementById("end").classList.add("d-none");
  document.getElementById("restart").classList.add("d-none");
  document.getElementById("analysisWrap").classList.add("d-none");
  displayQuestion();
}

function endGame(){
  clearInterval(timerInterval);
  ["score","timer","question","options"].forEach(id=>document.getElementById(id).classList.add("d-none"));
  document.getElementById("end").innerHTML = `<b>Game over!</b><br>
    <span class="text-success">Correct: ${correct}</span><br>
    <span class="text-danger">Incorrect: ${incorrect}</span><br>
    Attempted: ${correct+incorrect} / ${numQuestions}`;
  document.getElementById("end").classList.remove("d-none");
  document.getElementById("restart").classList.remove("d-none");
  showAnalysis();
}

function getScoreBadge(pct){
  let color = pct>=85?"success":pct>=70?"primary":pct>=55?"warning":"danger";
  return `<span class="badge badge-score bg-${color}">${pct}% Score</span>`;
}

function showAnalysis(){
  const analysisTable=document.getElementById("analysis");
  let attempted=userHistory.length;
  let html = `<thead>
      <tr><th>#</th><th>Question</th><th>Your Answer</th><th>Correct</th></tr>
    </thead><tbody>`;
  userHistory.forEach((row,i)=>{
    let rowClass = row.isCorrect ? "correct" : "incorrect";
    html += `<tr class="${rowClass}">
      <td>${i+1}</td>
      <td>${row.question}</td>
      <td class="${row.isCorrect?'ans-ok':'ans-bad'}">${row.userAnswer}</td>
      <td class="ans-ok">${row.correctAnswer}</td>
    </tr>`;
  });
  html += "</tbody>"; analysisTable.innerHTML=html;
  let pct = attempted===0?0:Math.round((correct/attempted)*100);
  document.getElementById("scorecardRow").innerHTML=getScoreBadge(pct);
  document.getElementById("analysisWrap").classList.remove("d-none");
}

document.getElementById("restart").addEventListener("click",()=>{document.getElementById("end").classList.add("d-none"); startGame();});
document.getElementById("start").addEventListener("click", startGame);
</script>
</body>
</html>
